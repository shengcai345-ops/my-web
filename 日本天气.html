<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>æ—¥æœ¬ç¤¾äº¤æƒ…æŠ¥çœ‹æ¿ - å†³ç­–ç‰ˆ</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root {
            --bg: #F2F2F7;
            --card: #FFFFFF;
            --blue: #007AFF;
            --text-main: #1C1C1E;
            --text-sub: #3A3A3C;
            --gray: #8E8E93;
            --radius: 28px;
        }

        /* æè‡´æŸ”å’Œå­—ä½“æ¸²æŸ“ */
        * { 
            margin: 0; padding: 0; box-sizing: border-box; 
            -webkit-font-smoothing: antialiased; 
            text-rendering: optimizeLegibility;
            /* æ¶ˆé™¤é”‹åˆ©æ„Ÿçš„å¾®è°ƒï¼šè½»å¾®å­—é—´è·ä¸å¾®æ™•æŸ“ */
            letter-spacing: -0.01em;
            text-shadow: 0 0 1px rgba(0,0,0,0.01);
        }

        body {
            background-color: var(--bg);
            color: var(--text-main);
            /* æ—¥æœ¬é¡¶çº§åœ†æ¶¦å­—ä½“æ ˆï¼šHiragino Sans */
            font-family: "Hiragino Sans", "PingFang SC", "Hiragino Kaku Gothic ProN", sans-serif;
            padding: 25px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            flex-direction: column;
            gap: 25px;
        }

        /* é¡¶éƒ¨æ ‡é¢˜æ  */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 10px;
        }
        .header h1 { font-size: 22px; font-weight: 700; color: #000; }
        .header .clock { font-family: "SF Pro Display", monospace; font-size: 16px; color: var(--gray); font-weight: 600; }

        /* ç¤¾äº¤ç­–ç•¥å¼•æ“ */
        .strategy-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
        }

        .strategy-card {
            background: var(--card);
            padding: 24px;
            border-radius: var(--radius);
            box-shadow: 0 10px 30px rgba(0,0,0,0.03);
            display: flex;
            flex-direction: column;
            gap: 12px;
            border: 1px solid rgba(0,0,0,0.02);
        }

        .tag { font-size: 11px; font-weight: 700; color: var(--blue); text-transform: uppercase; letter-spacing: 0.8px; }
        .strategy-text { font-size: 14px; line-height: 1.7; color: var(--text-sub); }

        /* å¤©æ°”å±•ç¤ºåŒº */
        .section-title { font-size: 17px; font-weight: 700; margin: 10px 0 15px 10px; color: var(--gray); }
        .weather-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(190px, 1fr)); gap: 15px; }
        
        .city-card {
            background: var(--card);
            padding: 22px;
            border-radius: 22px;
            text-align: center;
            border: 1px solid rgba(0,0,0,0.03);
            transition: 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
        }
        .city-card:hover { transform: translateY(-4px); box-shadow: 0 12px 24px rgba(0,0,0,0.06); }
        .city-name { font-weight: 700; font-size: 16px; margin-bottom: 5px; }
        .city-temp { font-size: 30px; font-weight: 300; color: var(--blue); margin-bottom: 8px; }
        .city-prediction { font-size: 12px; color: var(--blue); font-weight: 600; background: #F0F7FF; padding: 4px 8px; border-radius: 8px; display: inline-block; }

        /* äºŒçº¿åŸå¸‚æ”¶çº³ */
        summary { 
            padding: 15px; color: var(--gray); cursor: pointer; font-size: 14px; 
            font-weight: 600; list-style: none; display: flex; align-items: center; gap: 6px; 
        }
        summary::before { content: 'ğŸ“'; }

        @media (max-width: 900px) {
            .strategy-grid { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>

    <div class="container">
        <header class="header">
            <h1>ğŸ‡¯ğŸ‡µ æ—¥æœ¬ç¤¾äº¤æƒ…æŠ¥çœ‹æ¿</h1>
            <div class="clock" id="jstClock">00:00:00 JST</div>
        </header>

        <div class="strategy-grid">
            <div class="strategy-card">
                <span class="tag">â›ˆï¸ å¤©æ°”ç ´å†° (ä¸€å°æ—¶é¢„æµ‹)</span>
                <div class="strategy-text" id="weatherTalk">æ­£åœ¨åŒæ­¥æ°”è±¡æ•°æ®...</div>
            </div>
            <div class="strategy-card">
                <span class="tag">ğŸ± æ—¶ä»¤/é¤é¥®å»ºè®®</span>
                <div class="strategy-text" id="foodTalk">æ­£åœ¨æ ¹æ®å½“å‰æ—¶é—´åˆ†æ...</div>
            </div>
            <div class="strategy-card">
                <span class="tag">ğŸ’¡ æ—¥æœ¬æ–‡åŒ–è¶£é—»</span>
                <div class="strategy-text" id="cultureTalk">æ­£åœ¨æå–ä»Šæ—¥è°ˆèµ„...</div>
            </div>
        </div>

        <div>
            <div class="section-title">æ ¸å¿ƒéƒ½å¸‚å®å†µ</div>
            <div class="weather-grid" id="mainCities"></div>
        </div>

        <details>
            <summary>æŸ¥çœ‹æ›´å¤šåŸå¸‚ (æ¨ªæ»¨/ç¥æˆ·/é‚£éœ¸ç­‰)</summary>
            <div class="weather-grid" id="subCities" style="margin-top:15px;"></div>
        </details>
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.ready();

        const mainCitiesList = [
            { name: "ä¸œäº¬", lat: 35.69, lon: 139.69 },
            { name: "å¤§é˜ª", lat: 34.69, lon: 135.50 },
            { name: "äº¬éƒ½", lat: 35.01, lon: 135.76 },
            { name: "æœ­å¹Œ", lat: 43.06, lon: 141.35 },
            { name: "ç¦å†ˆ", lat: 33.59, lon: 130.40 },
            { name: "åå¤å±‹", lat: 35.18, lon: 136.90 }
        ];

        const subCitiesList = [
            { name: "æ¨ªæ»¨", lat: 35.44, lon: 139.63 },
            { name: "ç¥æˆ·", lat: 34.69, lon: 135.19 },
            { name: "å†²ç»³", lat: 26.21, lon: 127.68 },
            { name: "ä»™å°", lat: 38.26, lon: 140.87 },
            { name: "å¹¿å²›", lat: 34.38, lon: 132.45 },
            { name: "ç®±æ ¹", lat: 35.23, lon: 139.10 }
        ];

        const tidbits = [
            "1æœˆ7æ—¥æ˜¯â€˜ä¸ƒè‰èŠ‚â€™ï¼Œå–ä¸Šä¸€ç¢—çƒ­ä¹ä¹çš„ä¸ƒè‰ç²¥æ˜¯æ—¥æœ¬å»¶ç»­åƒå¹´çš„ä¼ ç»Ÿã€‚",
            "åœ¨ä¸œäº¬ï¼Œæ‰¶æ¢¯å¤§å®¶ä¹ æƒ¯ç«™å·¦è¾¹ï¼›åˆ°äº†å¤§é˜ªï¼Œå¤§å®¶åˆ™ä¹ æƒ¯ç«™å³è¾¹ï¼Œè¿™æ˜¯å¾ˆæœ‰è¶£çš„åœ°åŸŸå·®å¼‚ã€‚",
            "è¿›å…¥æ—¥æœ¬å±…é…’å±‹ï¼Œå¦‚æœä¸æ“…é•¿å–é…’ï¼Œå¯ä»¥è¯´â€˜ä¹Œé¾™èŒ¶â€™ï¼ˆã‚¦ãƒ¼ãƒ­ãƒ³èŒ¶ï¼‰ï¼Œè¿™åœ¨ç¤¾äº¤ä¸Šéå¸¸å¾—ä½“ã€‚",
            "æ—¥æœ¬çš„è‡ªåŠ¨è´©å–æœºä¸ä»…å–é¥®æ–™ï¼Œè¿˜æœ‰äº›åœ¨åè¿œåœ°åŒºå–çƒ­è…¾è…¾çš„æ±‰å ¡æˆ–æ‹‰é¢ç½å¤´ã€‚",
            "åœ¨å•†åŠ¡ä¼šé¢ä¸­ï¼Œå³ä¾¿ä¸å†·ï¼Œç©¿ç€è¥¿è£…å¤–å¥—ä¹Ÿä¼šè¢«è®¤ä¸ºæ¯”åªç©¿è¡¬è¡«æ›´æ­£å¼å’Œä¸“ä¸šã€‚"
        ];

        async function updateDashboard() {
            const now = new Date();
            const hour = (now.getUTCHours() + 9) % 24;
            
            // éšæœºè¶£å‘³
            document.getElementById('cultureTalk').innerText = tidbits[Math.floor(Math.random() * tidbits.length)];

            let tokyoFuture = "";

            const fetchWeather = async (list, id) => {
                const container = document.getElementById(id);
                container.innerHTML = '';
                for (const city of list) {
                    try {
                        const url = `https://api.open-meteo.com/v1/jma?latitude=${city.lat}&longitude=${city.lon}&current=temperature_2m,weather_code&hourly=temperature_2m,precipitation&timezone=Asia%2FTokyo&forecast_days=1`;
                        const res = await fetch(url);
                        const data = await res.json();
                        
                        const curTemp = Math.round(data.current.temperature_2m);
                        const nextHourRain = data.hourly.precipitation[hour + 1] || 0;
                        const nextHourTemp = Math.round(data.hourly.temperature_2m[hour + 1]);

                        // æ™ºèƒ½é¢„æµ‹ç»“è®º
                        let predict = "";
                        if (nextHourRain > 0) predict = "ä¸€å°æ—¶åï¼šæœ‰é›¨ ğŸŒ§ï¸";
                        else if (nextHourTemp < curTemp - 1) predict = "ä¸€å°æ—¶åï¼šæ¸©é™ â„ï¸";
                        else if (nextHourTemp > curTemp + 1) predict = "ä¸€å°æ—¶åï¼šå‡æ¸© â˜€ï¸";
                        else predict = "ä¸€å°æ—¶åï¼šå¤©æ°”å¹³ç¨³";

                        const card = document.createElement('div');
                        card.className = 'city-card';
                        card.innerHTML = `
                            <div class="city-name">${city.name}</div>
                            <div class="city-temp">${curTemp}Â°</div>
                            <div class="city-prediction">${predict}</div>
                        `;
                        container.appendChild(card);
                        
                        if(city.name === "ä¸œäº¬") tokyoFuture = predict;
                    } catch (e) { console.error(e); }
                }
            };

            await fetchWeather(mainCitiesList, 'mainCities');
            await fetchWeather(subCitiesList, 'subCities');

            // æ™ºèƒ½è¯æœ¯å¼•æ“
            if(tokyoFuture) {
                let wt = "ä¸œäº¬å®å†µï¼š";
                if(tokyoFuture.includes("é›¨")) wt += "â€˜çœ‹é¢„æŠ¥ä¸œäº¬ä¸€å°æ—¶åå¯èƒ½è½¬é›¨ï¼Œæ‚¨è‹¥åœ¨é‚£è¾¹ï¼Œè®°å¾—å¸¦æŠŠä¼ã€‚â€™";
                else if(tokyoFuture.includes("æ¸©é™")) wt += "â€˜ä¸œäº¬ä¸€å°æ—¶åæ°”æ¸©ä¼šä¸‹é™ï¼Œå®¤å†…å¤–æ¸©å·®å¤§ï¼Œè¯·å¤šä¿é‡ã€‚â€™";
                else wt += "â€˜ä¸œäº¬æ¥ä¸‹æ¥çš„å¤©æ°”éå¸¸ç¨³å®šï¼Œå¾ˆé€‚åˆæˆ·å¤–ä¼šé¢æˆ–æ•£æ­¥ã€‚â€™";
                document.getElementById('weatherTalk').innerText = wt;
                
                let ft = "";
                if(hour >= 6 && hour < 10) ft = "æ—©é¤æ—¶é—´ï¼šâ€˜ä¾¿åˆ©åº—çš„é¥­å›¢é…ä¸Šæ¸©çƒ­çš„å‘³å™Œæ±ï¼Œæ˜¯å¼€å¯æ—¥æœ¬å†¬æ—¥æ—©æ™¨çš„ç»å…¸ã€‚â€™";
                else if(hour >= 11 && hour < 14) ft = "åˆé¤æ—¶é—´ï¼šâ€˜ç°åœ¨å»åƒä¸€ç¢—åœ°é“çš„èéº¦é¢ï¼ˆSobaï¼‰ï¼Œæ¸…çˆ½åˆåœ°é“ã€‚â€™";
                else if(hour >= 15 && hour < 17) ft = "ä¸‹åˆèŒ¶ï¼šâ€˜å¦‚æœèƒ½åœ¨è¿™ç§å¤©æ°”åƒä¸€ä»½è‰è“å¤§ç¦é…æŠ¹èŒ¶ï¼Œæ„Ÿè§‰ä¼šå¾ˆèµã€‚â€™";
                else if(hour >= 18 && hour < 21) ft = "æ™šé¤å»ºè®®ï¼šâ€˜å¤©å†·äº†ï¼Œæ­£æ˜¯å»åƒé¡¿ã€å’Œç‰›å¯¿å–œçƒ§ã€‘æˆ–è€…çƒ¤è‚‰ï¼ˆYakinikuï¼‰çš„æœ€ä½³æ—¶æœºã€‚â€™";
                else ft = "æ·±å¤œè¯é¢˜ï¼šâ€˜æ·±å¤œçš„æ—¥æœ¬è¡—å¤´ï¼Œå»åƒç¢—æµ“åšçš„åšå¤šæ‹‰é¢æ˜¯æœ€æœ‰å½’å±æ„Ÿçš„ã€‚â€™";
                document.getElementById('foodTalk').innerText = ft;
            }
        }

        function updateClock() {
            const now = new Date();
            const jst = new Date(now.getTime() + (9 * 60 * 60 * 1000) - (now.getTimezoneOffset() * 60000));
            document.getElementById('jstClock').innerText = jst.toISOString().substr(11, 8) + " JST";
        }

        // å¯åŠ¨
        updateDashboard();
        setInterval(updateClock, 1000);
        setInterval(updateDashboard, 600000); // 10åˆ†é’ŸåŒæ­¥ä¸€æ¬¡é€»è¾‘
    </script>
</body>
</html>