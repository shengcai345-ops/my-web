<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>JAPAN COMMAND CENTER</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root {
            --bg: #050505;
            --panel: #121214;
            --border: #242426;
            --accent: #32D74B; 
            --info: #0A84FF;
            --warn: #FF9F0A;
            --text: #FFFFFF;
            --text-dim: #8E8E93;
            --card-hover: #1C1C1E;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-font-smoothing: antialiased; }

        body {
            background-color: var(--bg);
            color: var(--text);
            font-family: -apple-system, "Inter", "Segoe UI", "Hiragino Sans", sans-serif;
            padding: 24px;
            line-height: 1.5;
        }

        /* å“åº”å¼å®¹å™¨ */
        .container { max-width: 1400px; margin: 0 auto; }

        /* é¡¶éƒ¨çŠ¶æ€æ  */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid var(--border);
            padding-bottom: 20px;
            margin-bottom: 30px;
            flex-wrap: wrap;
            gap: 20px;
        }
        .header h1 { font-size: 24px; font-weight: 800; letter-spacing: -1px; }
        .header h1 span { color: var(--info); }
        
        .time-group { display: flex; gap: 30px; align-items: center; }
        #jstClock { font-family: monospace; font-size: 28px; font-weight: 700; color: var(--accent); }
        #jstDate { font-size: 13px; color: var(--text-dim); text-align: right; }

        /* ç¤¾äº¤å†³ç­–çŸ©é˜µ - è‡ªé€‚åº”ç½‘æ ¼ */
        .section-title { font-size: 12px; font-weight: 700; color: var(--text-dim); margin-bottom: 15px; text-transform: uppercase; letter-spacing: 2px; }
        
        .decision-matrix {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 16px;
            margin-bottom: 35px;
        }
        .decision-card {
            background: var(--panel);
            border: 1px solid var(--border);
            border-radius: 20px;
            padding: 20px;
            transition: 0.3s cubic-bezier(0.2, 0, 0, 1);
        }
        .decision-card:hover { border-color: var(--info); background: var(--card-hover); }
        .card-tag { font-size: 10px; font-weight: 800; color: var(--info); margin-bottom: 12px; display: block; opacity: 0.8; }
        .card-content { font-size: 14px; color: #E5E5E7; font-weight: 500; min-height: 45px; }

        /* ä¸»å¸ƒå±€ï¼šå·¦ä¾§å¤©æ°”ï¼Œå³ä¾§æ´»åŠ¨ */
        .main-layout {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 24px;
        }

        @media (max-width: 900px) {
            .main-layout { grid-template-columns: 1fr; }
            body { padding: 16px; }
        }

        /* æ°”è±¡é¢æ¿ */
        .city-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 12px; }
        .city-card {
            background: var(--panel); border: 1px solid var(--border); border-radius: 20px;
            padding: 18px; transition: 0.2s;
        }
        .city-name { font-size: 13px; font-weight: 700; color: var(--text-dim); margin-bottom: 12px; }
        .temp-row { display: flex; align-items: baseline; gap: 5px; }
        .temp-val { font-size: 32px; font-weight: 300; }
        .weather-badge { font-size: 10px; font-weight: 700; padding: 3px 8px; border-radius: 6px; margin-top: 8px; display: inline-block; }

        /* æ´»åŠ¨æ—¥å†é¢æ¿ */
        .event-list { background: var(--panel); border: 1px solid var(--border); border-radius: 20px; padding: 20px; }
        .event-item { 
            padding: 12px 0; border-bottom: 1px solid var(--border); 
            display: flex; gap: 15px; align-items: flex-start;
        }
        .event-item:last-child { border: none; }
        .ev-date { font-size: 11px; font-weight: 800; color: var(--warn); white-space: nowrap; margin-top: 2px; }
        .ev-info { font-size: 13px; font-weight: 600; }
        .ev-loc { font-size: 11px; color: var(--text-dim); margin-top: 2px; }

        /* è¶‹åŠ¿æ ‡ç­¾ */
        .up { background: rgba(255, 69, 58, 0.15); color: #FF453A; }
        .down { background: rgba(10, 132, 255, 0.15); color: #0A84FF; }
        .stable { background: rgba(50, 215, 75, 0.15); color: #32D74B; }

        summary { cursor: pointer; padding: 15px; color: var(--info); font-size: 13px; font-weight: 600; text-align: center; list-style: none; }
    </style>
</head>
<body>

    <div class="container">
        <header class="header">
            <h1>JP <span>INSIGHT</span></h1>
            <div class="time-group">
                <div id="jstClock">00:00:00</div>
                <div id="jstDate">JAN 07 WED / TOKYO</div>
            </div>
        </header>

        <div class="section-title">ç¤¾äº¤å†³ç­–çŸ©é˜µ Â· å››ç»´å»ºè®®</div>
        <div class="decision-matrix">
            <div class="decision-card">
                <span class="card-tag">æ—¶ä»¤è¯é¢˜ / SEASONAL</span>
                <div class="card-content" id="topicSeason">æ­£åœ¨è·å–å½“å‰æ°‘ä¿—è¯é¢˜...</div>
            </div>
            <div class="decision-card">
                <span class="card-tag">é•¿å‡é¢„åˆ¤ / HOLIDAY</span>
                <div class="card-content" id="topicHoliday">åˆ†æè¿‘æœŸè¿ä¼‘è®¡åˆ’ä¸­...</div>
            </div>
            <div class="decision-card">
                <span class="card-tag">æ°”è±¡å…³å¿ƒ / CLIMATE</span>
                <div class="card-content" id="topicWeather">æ ¹æ®å®æ—¶æ¸©å·®ç”Ÿæˆå»ºè®®...</div>
            </div>
            <div class="decision-card">
                <span class="card-tag">ç¤¾äº¤çª—å£ / WINDOW</span>
                <div class="card-content" id="topicWindow">è®¡ç®—å¯¹æ–¹å½“å‰ç¤¾äº¤æ´»è·ƒåº¦...</div>
            </div>
        </div>

        <div class="main-layout">
            <div>
                <div class="section-title">ä¸»è¦éƒ½å¸‚æ°”è±¡ Â· å®å†µåŠé¢„æµ‹</div>
                <div class="city-grid" id="mainCities"></div>
                <details>
                    <summary>æŸ¥çœ‹æ¬¡è¦éƒ½å¸‚æƒ…å†µ</summary>
                    <div class="city-grid" id="subCities" style="margin-top:10px;"></div>
                </details>
            </div>

            <div>
                <div class="section-title">è¿‘æœŸæ´»åŠ¨ / èŠ‚æ—¥åŠ¨æ€</div>
                <div class="event-list" id="eventBox">
                    </div>
            </div>
        </div>
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.ready();

        const cities = {
            main: [
                { name: "ä¸œäº¬ (Tokyo)", lat: 35.69, lon: 139.69 },
                { name: "å¤§é˜ª (Osaka)", lat: 34.69, lon: 135.50 },
                { name: "äº¬éƒ½ (Kyoto)", lat: 35.01, lon: 135.76 },
                { name: "æœ­å¹Œ (Sapporo)", lat: 43.06, lon: 141.35 }
            ],
            sub: [
                { name: "ç¦å†ˆ", lat: 33.59, lon: 130.40 },
                { name: "åå¤å±‹", lat: 35.18, lon: 136.90 },
                { name: "æ¨ªæ»¨", lat: 35.44, lon: 139.63 },
                { name: "å†²ç»³", lat: 26.21, lon: 127.68 }
            ]
        };

        const eventData = [
            { date: "01/07", name: "ä¸ƒè‰èŠ‚ (Nanakusa)", loc: "å…¨æ—¥æœ¬ / ä¼ ç»Ÿä¹ ä¿—" },
            { date: "01/09", name: "åæ—¥æˆ (Tokka Ebisu)", loc: "å¤§é˜ªä»Šå®«æˆç¥ç¤¾ / ç¥­å…¸" },
            { date: "01/12", name: "æˆäººä¹‹æ—¥ (Coming of Age Day)", loc: "å…¨å›½å…¬ä¼‘æ—¥ / ä¸‰è¿ä¼‘" },
            { date: "01/15", name: "ä¸–ç”°è°·æ—§è´§å¸‚", loc: "ä¸œäº¬ / 400å¹´å†å²å¤§é›†" },
            { date: "01/25", name: "åˆå¤©ç¥", loc: "å…¨æ—¥æœ¬å¤©æ»¡å®« / ç¥­å…¸" }
        ];

        async function updateWeather(list, containerId) {
            const container = document.getElementById(containerId);
            container.innerHTML = '';
            for (const city of list) {
                try {
                    const res = await fetch(`https://api.open-meteo.com/v1/forecast?latitude=${city.lat}&longitude=${city.lon}&current=temperature_2m,precipitation&hourly=temperature_2m&timezone=Asia%2FTokyo&forecast_days=1`);
                    const data = await res.json();
                    const curTemp = Math.round(data.current.temperature_2m);
                    const nextTemp = Math.round(data.hourly.temperature_2m[new Date().getHours() + 1] || curTemp);
                    const isRain = data.current.precipitation > 0;

                    let badge = "æ°”æ¸©å¹³ç¨³"; let cls = "stable";
                    if (isRain) { badge = "æ­£åœ¨é™é›¨ ğŸŒ§ï¸"; cls = "down"; }
                    else if (nextTemp > curTemp + 1) { badge = "é¢„æµ‹å‡æ¸© â†‘"; cls = "up"; }
                    else if (nextTemp < curTemp - 1) { badge = "é¢„æµ‹é™æ¸© â†“"; cls = "down"; }

                    const card = document.createElement('div');
                    card.className = 'city-card';
                    card.innerHTML = `<div class="city-name">${city.name}</div><div class="temp-row"><span class="temp-val">${curTemp}Â°</span></div><div class="weather-badge ${cls}">${badge}</div>`;
                    container.appendChild(card);
                } catch (e) {}
            }
        }

        function updateDecision() {
            const now = new Date();
            const jst = new Date(now.getTime() + (now.getTimezoneOffset() + 540) * 60000);
            const hour = jst.getHours();
            const md = (jst.getMonth() + 1) + "-" + jst.getDate();

            // è¯é¢˜1: æ—¶ä»¤
            document.getElementById('topicSeason').innerText = md === "1-7" ? "ä»Šæ—¥æ˜¯ä¸ƒè‰èŠ‚ï¼Œæ—¥æœ¬ä¹ ä¿—æ˜¯å–ä¸ƒè‰ç²¥æ¸…ç†è‚ èƒƒç¥ˆæ±‚å¥åº·ï¼Œå¾ˆé€‚åˆä½œä¸ºä»Šæ—¥åˆ‡å…¥ç‚¹ã€‚" : "ç›®å‰å¤„äºæ–°å¹´åçš„æ¢å¤æœŸï¼Œé€‚åˆèŠèŠæ–°å¹´çš„è®¡åˆ’æˆ–å‡æœŸæœŸé—´å»å“ªé‡Œæ¸¸ç©ã€‚";
            
            // è¯é¢˜2: é•¿å‡
            document.getElementById('topicHoliday').innerText = "æœ¬å‘¨å…­åˆ°ä¸‹å‘¨ä¸€æ˜¯â€˜æˆäººä¹‹æ—¥â€™å¸¦æ¥çš„ä¸‰è¿ä¼‘ã€‚å»ºè®®åœ¨å‘¨äº”å‰ç¡®è®¤å¯¹æ–¹çš„å‡æœŸå®‰æ’ï¼Œæ­¤æ—¶ä¸å®œèŠå¤æ‚å·¥ä½œã€‚";

            // è¯é¢˜3: æ°”å€™ (ç®€æ˜“é€»è¾‘ï¼Œå®é™…å¯æ ¹æ®ä¸œäº¬æ°”è±¡åŠ¨æ€)
            document.getElementById('topicWeather').innerText = "ä¸œäº¬ä»Šæ—¥æ—©æ™šæ¸©å·®è¾ƒå¤§ã€‚å¦‚æœå¯¹æ–¹åœ¨ä¸œäº¬ï¼Œä¸‹åˆ18ç‚¹åå»ºè®®æé†’å¯¹æ–¹æ³¨æ„é˜²å¯’ä¿æš–ï¼Œå¢åŠ äº²è¿‘æ„Ÿã€‚";

            // è¯é¢˜4: ç¤¾äº¤çª—å£
            let windowAdvice = "";
            if (hour >= 23 || hour < 7) windowAdvice = "å½“å‰ä¸ºæ·±å¤œã€‚å¯¹æ–¹å·²ä¼‘æ¯ï¼Œä¸å»ºè®®å‘é€ä»»ä½•ç¤¾äº¤è¯·æ±‚æˆ–éç´§æ€¥å·¥ä½œã€‚";
            else if (hour >= 12 && hour < 13) windowAdvice = "åˆä¼‘æ—¶é—´ã€‚é€‚åˆå‘é€éæ­£å¼çš„é—®å€™ã€çº¦é¥­æˆ–åˆ†äº«æœ‰è¶£çš„æ–°é—»ã€‚";
            else if (hour >= 18 && hour < 21) windowAdvice = "æ™šé—´æ´»è·ƒæœŸã€‚å¯¹æ–¹å¤šåœ¨å±…é…’å±‹æˆ–å®¶ä¸­ï¼Œå›å¤ç‡æœ€é«˜ï¼Œé€‚åˆè¿›è¡Œæ·±åº¦æ²Ÿé€šã€‚";
            else windowAdvice = "å·¥ä½œç¹å¿™æœŸã€‚å»ºè®®è¨€ç®€æ„èµ…ï¼Œå¦‚æœæ˜¯ä¸šåŠ¡å’¨è¯¢ï¼Œå¯¹æ–¹å¯èƒ½åœ¨17ç‚¹åæ‰ä¼šç»Ÿä¸€å›å¤ã€‚";
            document.getElementById('topicWindow').innerText = windowAdvice;
        }

        function init() {
            // å¡«å……æ´»åŠ¨
            const evBox = document.getElementById('eventBox');
            eventData.forEach(ev => {
                const item = document.createElement('div');
                item.className = 'event-item';
                item.innerHTML = `<div class="ev-date">${ev.date}</div><div><div class="ev-info">${ev.name}</div><div class="ev-loc">${ev.loc}</div></div>`;
                evBox.appendChild(item);
            });

            // æ—¶é’Ÿ
            setInterval(() => {
                const now = new Date();
                const jst = new Date(now.getTime() + (now.getTimezoneOffset() + 540) * 60000);
                document.getElementById('jstClock').innerText = jst.toTimeString().split(' ')[0];
                document.getElementById('jstDate').innerText = jst.toLocaleDateString('en-US', {month:'short', day:'2-digit', weekday:'short'}).toUpperCase() + " / TOKYO JST";
            }, 1000);

            updateDecision();
            updateWeather(cities.main, 'mainCities');
            updateWeather(cities.sub, 'subCities');
        }

        init();
    </script>
</body>
</html>